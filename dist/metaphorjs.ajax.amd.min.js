define("metaphorjs-ajax",["metaphorjs-observable","metaphorjs-promise","metaphorjs-select","metaphorjs-class"],function(U,M,N,V){function y(a){return"object"==typeof a&&3===G(a)&&!a.nodeType&&a.constructor===Object}function O(a){return!0===a||!1===a}function r(a){return"string"==typeof a||a===""+a}function B(a,b){return a.getAttribute?a.getAttribute(b):null}function H(a){return"object"===typeof a&&5===G(a)}function I(a){if(null===a||"object"!=typeof a)return!1;a=G(a);return 2<a||-1==a}function J(){}
function z(a,b,c,e){return setTimeout(function(){a.apply(b,c||[])},e||0)}function P(a,b){if(!a||!r(a))return null;try{var c=new DOMParser;var e=c.parseFromString(a,b||"text/xml")}catch(d){e=void 0}if(!e||e.getElementsByTagName("parsererror").length)throw"Invalid XML: "+a;return e}function C(){return!1}function D(){return!0}var x=Array.prototype.slice,W=Object.prototype.toString,G=function(){var a={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,
"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(b){if(!b){if(null===b)return 6;if(void 0===b)return 7}var c=a[W.call(b)];return void 0===c?-1:1===c&&isNaN(b)?8:c}}(),v=function(){return function b(){var c=!1,e=!1,d=x.call(arguments),f=d.shift(),n,k,g;O(d[d.length-1])&&(c=d.pop());O(d[d.length-1])&&(e=c,c=d.pop());for(;d.length;)if((n=d.shift())&&n.hasOwnProperty)for(k in n)if(n.hasOwnProperty(k)&&void 0!==(g=n[k]))if(e)if(f[k]&&y(f[k])&&y(g))b(f[k],g,c,e);else{if(!0===c||
void 0==f[k])y(g)?(f[k]={},b(f[k],g,c,!0)):f[k]=g}else if(!0===c||void 0==f[k])f[k]=g;return f}}(),X=function(){var a,b=function(b){var c={},d=[];0==arguments.length&&(b=!0);return{addFinder:function(a,b,c){d[c?"unshift":"push"]({fn:a,context:b})},add:function(a,d,e){if(c[a]&&!1===c[a].rewritable)return c[a];c[a]={rewritable:"undefined"!=typeof e?e:b,value:d};return d},get:function(a){if(c[a])return c[a].value;if(d.length){var b;var e=0;for(b=d.length;e<b;e++){var f=d[e].fn.call(d[e].context,a,this);
if(void 0!==f)return this.add(a,f,!0)}}},remove:function(a){var b=c[a];b&&!0===b.rewritable&&delete c[a];return b?b.value:void 0},exists:function(a){return!!c[a]},eachEntry:function(a,b){for(var d in c)a.call(b,c[d].value,d)},destroy:function(){this===a&&(a=null);this.remove=this.exists=this.destroy=this.get=this.add=b=c=null}}};b.global=function(){a||(a=new b(!0));return a};return b}(),t={},Q=new (function(){var a=function(a,b,f){f=f||new X(!1);var d=b?b.length:null;a||(a="undefined"!==typeof global?
global:window);var e=function(a){return a&&b&&a.substr(0,d)!==b?b+"."+a:a},g=function(c,d){c=e(c);if(f.exists(c))return f.get(c);if(!d){d=c.split(".");var l,h=d.length,q=a;for(l=0;l<h;l++){var w=d[l];if(b&&0===l&&w===b)q=a;else{if(void 0===q[w])return;q=q[w]}}q&&f.add(c,q);return q}};this.register=function(c,d){c=e(c);var n=c.split("."),h=n.pop();var q=n.join(".");var w=n.length,g=a;if(f[q])c=[f[q],h,c];else{if(0<w)for(q=0;q<w;q++){var l=n[q];b&&0===q&&l===b?g=a:(void 0===g[l]&&(g[l]={}),g=g[l])}c=
[g,h,c]}n=c[0];h=c[1];I(n)&&void 0===n[h]&&(n[h]=d,f.add(c[2],d));return d};this.exists=function(a){return void 0!==g(a,!0)};this.get=g;this.add=function(a,b){a=e(a);f.add(a,b);return b};this.remove=function(a){a=e(a);f.remove(a)};this.normalize=e;this.makeAlias=function(a,b){a=e(a);b=e(b);a=f.get(a);void 0!==a&&f.add(b,a)};this.destroy=function(){var a;this===c&&(c=null);f.eachEntry(function(a){a&&a.$destroy&&a.$destroy()});f.destroy();f=null;for(a in this)this[a]=null}},b=a.prototype;b=b.register=
b.exists=b.get=b.add=b.remove=b.normalize=b.makeAlias=b.destroy=null;var c;a.global=function(){c||(c=new a);return c};return a}())(t,"MetaphorJs"),E=(new V(Q)).define,u=Function.prototype.bind?function(a,b){return a.bind(b)}:function(a,b){return function(){return a.apply(b,arguments)}},R=function(){return String.prototype.trim?function(a){return r(a)?a.trim():a}:function(a){return r(a)?a.replace(/^\s\s*/,"").replace(/\s\s*$/,""):a}}(),Y=function(){return"undefined"!=typeof JSON?function(a){return JSON.parse(a)}:
function(a){return(new Function("return "+a))()}}(),L=function(){var a=["0","0","0"];return function(){for(var b=a.length,c;b;){b--;c=a[b].charCodeAt(0);if(57==c)return a[b]="A",a.join("");if(90==c)a[b]="0";else return a[b]=String.fromCharCode(c+1),a.join("")}a.unshift("0");return a.join("")}}();v(function(a,b){this.name=a;this.listeners=[];this.map={};this.hash=L();this.uni="$$"+a+"_"+this.hash;this.suspended=!1;this.lid=0;"object"===typeof b&&null!==b?v(this,b,!0,!1):this.returnResult=b}.prototype,
{name:null,listeners:null,map:null,hash:null,uni:null,suspended:!1,lid:null,returnResult:null,autoTrigger:null,lastTrigger:null,triggerFilter:null,filterContext:null,expectPromises:!1,resolvePromises:!1,getName:function(){return this.name},destroy:function(){for(var a in this)this[a]=null},on:function(a,b,c){if(!a)return null;b=b||null;c=c||{};var e=this.uni,d=a||b;if(d[e]&&!c.allowDupes)return null;var f=++this.lid,n=c.first||!1;d[e]=f;a={fn:a,context:b,uniContext:d,id:f,async:!1,called:0,limit:0,
start:1,count:0,append:null,prepend:null};v(a,c,!0,!1);!0===a.async&&(a.async=1);n?this.listeners.unshift(a):this.listeners.push(a);this.map[f]=a;if(this.autoTrigger&&this.lastTrigger&&!this.suspended){var k=this.triggerFilter;this.triggerFilter=function(a){return a.id===f?k?!1!==k(a):!0:!1};this.trigger.apply(this,this.lastTrigger);this.triggerFilter=k}return f},once:function(a,b,c){c=c||{};c.limit=1;return this.on(a,b,c)},un:function(a,b){var c=-1,e=this.uni,d=this.listeners;a=a==parseInt(a)?parseInt(a):
(b||a)[e];if(!a)return!1;b=0;for(var f=d.length;b<f;b++)if(d[b].id===a){c=b;delete d[b].uniContext[e];break}if(-1===c)return!1;d.splice(c,1);delete this.map[a];return!0},hasListener:function(a,b){var c=this.listeners;if(a){a="function"==typeof a?(b||a)[this.uni]:parseInt(a);if(!a)return!1;b=0;for(var e=c.length;b<e;b++)if(c[b].id===a)return!0;return!1}return 0<c.length},removeAllListeners:function(){var a=this.listeners,b=this.uni,c;var e=0;for(c=a.length;e<c;e++)delete a[e].uniContext[b];this.listeners=
[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(a,b){if(a.append||a.prepend)b=x.call(b),a.prepend&&(b=a.prepend.concat(b)),a.append&&(b=b.concat(a.append));return b},trigger:function(){var a=this,b=a.listeners,c=a.returnResult,e=a.triggerFilter,d=a.filterContext,f=a.expectPromises,n=[],k;if(a.suspended)return null;a.autoTrigger&&(a.lastTrigger=x.call(arguments));if(0===b.length)return null;var g="all"===c||"concat"===c?[]:"merge"===
c?{}:null,l,m;for(l="first"===c?[b[0]]:x.call(b);m=l.shift();)if(!(!m||!a.map[m.id]||(b=a._prepareArgs(m,arguments),e&&!1===e.call(d,m,b,a))||m.filter&&!1===m.filter.apply(m.filterContext||m.context,b)||(m.count++,m.count<m.start))){if(m.async&&!f){var p=null;z(m.fn,m.context,b,m.async)}else f?(p=function(b,c,d){return function(h){"pipe"===c&&(d[0]=h,d=a._prepareArgs(b,d));return b.fn.apply(b.context,d)}}(m,c,x.call(arguments)),p=k?k.then(p):m.fn.apply(m.context,b),p.catch(function(a){console.log(a)})):
p=m.fn.apply(m.context,b);m.called++;m.called===m.limit&&a.un(m.id);if("first"===c)return p;if(f)n.push(p),"pipe"===c&&p&&(k=p);else if(null!==c)if("all"===c)g.push(p);else if("concat"===c&&p)g=g.concat(p);else if("merge"===c)v(g,p,!0,!1);else{if("nonempty"===c&&p)return p;if("pipe"===c)g=p,arguments[0]=p;else if("last"===c)g=p;else{if(!1===c&&!1===p)return!1;if(!0===c&&!0===p)return!0}}}return f?(e=M.all(n),a.resolvePromises&&null!==c&&"all"!==c&&(e=e.then(function(a){var b,h=a.length;for(b=0;b<
h;b++){var d=a[b];if("concat"===c&&d)g=g.concat(d);else if("merge"===c)v(g,d,!0,!1);else{if("nonempty"===c&&d)return d;if(!1===c&&!1===d)return!1;if(!0===c&&!0===d)return!0}}return g})),e):g}},!0,!1);var Z=function(){var a=[],b=function(b){var c;var d=0;for(c=a.length;d<c;d++)if(!1===a[d][0].call(a[d][1],b))return;d=(b?b.stack:null)||Error().stack;if("undefined"!=typeof console&&console.error)b&&console.error(b),d&&console.error(d);else throw b;};b.on=function(c,e){b.un(c,e);a.push([c,e])};b.un=function(b,
e){var c;var f=0;for(c=a.length;f<c;f++)if(a[f][0]===b&&a[f][1]===e){a.splice(f,1);break}};return b}(),S=function(){function a(b,d,f){var e;if(H(d)){var k=0;for(e=d.length;k<e;k++){var g=d[k];c.test(b)?f(b,g):a(b+"["+("object"===typeof g?k:"")+"]",g,f)}}else if(y(d))for(k in d)a(b+"["+k+"]",d[k],f);else f(b,d)}var b=/%20/g,c=/\[\]$/;return function(c){var d,e=[],n=function(a,b){b="function"==typeof b?b():null==b?"":b;e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};for(d in c)a(d,c[d],
n);return e.join("&").replace(b,"+")}}();Q.register("mixin.Promise",{$$promise:null,$beforeInit:function(){this.$$promise=new M},then:function(){return this.$$promise.then.apply(this.$$promise,arguments)},done:function(){this.$$promise.done.apply(this.$$promise,arguments);return this},always:function(){this.$$promise.always.apply(this.$$promise,arguments);return this},fail:function(){this.$$promise.fail.apply(this.$$promise,arguments);return this}});(function(){var a={xml:"application/xml, text/xml",
html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"};return E({$class:"ajax.transport.XHR",type:"xhr",_xhr:null,_deferred:null,_ajax:null,$init:function(a,c,e){var b;window.XMLHttpRequest&&(b=new XMLHttpRequest)||(b=new ActiveXObject("Msxml2.XMLHTTP"));this._xhr=b;this._deferred=c;this._opt=a;this._ajax=e;a.progress&&(b.onprogress=u(a.progress,a.context));a.uploadProgress&&b.upload&&(b.upload.onprogress=u(a.uploadProgress,
a.context));b.onreadystatechange=u(this.onReadyStateChange,this)},setHeaders:function(){var b=this._opt,c=this._xhr,e;if(b.xhrFields)for(e in b.xhrFields)c[e]=b.xhrFields[e];b.data&&b.contentType&&c.setRequestHeader("Content-Type",b.contentType);c.setRequestHeader("X-Requested-With","XMLHttpRequest");c.setRequestHeader("Accept",b.dataType&&a[b.dataType]?a[b.dataType]+", */*; q=0.01":a._default);for(e in b.headers)c.setRequestHeader(e,b.headers[e])},onReadyStateChange:function(){var a=this._xhr,c=
this._deferred;if(0===a.readyState)a.onreadystatechange=J,c.resolve(a);else if(4===a.readyState){a.onreadystatechange=J;a:{try{var e=!a.status&&location&&"file:"==location.protocol||200<=a.status&&300>a.status||304===a.status||1223===a.status;break a}catch(d){}e=!1}if(e)this._ajax.processResponse(r(a.responseText)?a.responseText:void 0,a.getResponseHeader("content-type")||"");else{a.responseData=null;try{a.responseData=this._ajax.returnResponse(r(a.responseText)?a.responseText:void 0,a.getResponseHeader("content-type")||
"")}catch(d){}c.reject(a)}}},abort:function(){this._xhr.onreadystatechange=J;this._xhr.abort()},send:function(){var a=this._opt;try{this._xhr.open(a.method,a.url,!0,a.username,a.password),this.setHeaders(),this._xhr.send(a.data)}catch(c){this._deferred&&this._deferred.reject(c)}}})})();var A=function(a){if(a instanceof A)return a;if(!(this instanceof A))return new A(a);for(var b in a)if(!this[b])try{this[b]=a[b]}catch(d){}this.originalEvent=a;this.type=a.type;!this.target&&a.srcElement&&(this.target=
a.srcElement);var c=a.button;if(void 0===this.pageX&&null!==a.clientX){var e=this.target?this.target.ownerDocument||window.document:window.document;b=e.documentElement;e=e.body;this.pageX=a.clientX+(b&&b.scrollLeft||e&&e.scrollLeft||0)-(b&&b.clientLeft||e&&e.clientLeft||0);this.pageY=a.clientY+(b&&b.scrollTop||e&&e.scrollTop||0)-(b&&b.clientTop||e&&e.clientTop||0)}this.which||void 0===c||(this.which=c&1?1:c&2?3:c&4?2:0);this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===
a.returnValue?D:C;this.timeStamp=a&&a.timeStamp||(new Date).getTime()};v(A.prototype,{isDefaultPrevented:C,isPropagationStopped:C,isImmediatePropagationStopped:C,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=D;a.returnValue=!1;a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=D;a.cancelBubble=!0;a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=
D;a&&a.stopImmediatePropagation&&a.stopImmediatePropagation();this.stopPropagation()}},!0,!1);var T=function(a){function b(){e=null}var c,e;a=function(a){return function(d){var f=new A(d||window.event),k=x.call(arguments,1),g=0,l=0,m=0,p=0;f.type="mousewheel";"detail"in f&&(l=-1*f.detail);"wheelDelta"in f&&(l=f.wheelDelta);"wheelDeltaY"in f&&(l=f.wheelDeltaY);"wheelDeltaX"in f&&(g=-1*f.wheelDeltaX);"axis"in f&&f.axis===f.HORIZONTAL_AXIS&&(g=-1*l,l=0);var h=0===l?g:l;"deltaY"in f&&(h=l=-1*f.deltaY);
"deltaX"in f&&(g=f.deltaX,0===l&&(h=-1*g));if(0!==l||0!==g){var q=Math.max(Math.abs(l),Math.abs(g));if(!e||q<e)e=q,"mousewheel"===f.type&&0===q%120&&(e/=40);"mousewheel"===f.type&&0===q%120&&(h/=40,g/=40,l/=40);h=Math[1<=h?"floor":"ceil"](h/e);g=Math[1<=g?"floor":"ceil"](g/e);l=Math[1<=l?"floor":"ceil"](l/e);this.getBoundingClientRect&&(q=this.getBoundingClientRect(),m=f.clientX-q.left,p=f.clientY-q.top);f.deltaX=g;f.deltaY=l;f.deltaFactor=e;f.offsetX=m;f.offsetY=p;f.deltaMode=0;k.unshift(f,h,g,l);
c&&clearTimeout(c);c=setTimeout(b,200);return a.apply(this,k)}}};a.events=function(){var a=window.document;return"onwheel"in a||9<=a.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"]};return a}(),F=function(){var a=null,b=null;return function(c,e,d){null===a&&(c.addEventListener?(a="addEventListener",b=""):(a="attachEvent",b="on"));if("mousewheel"==e){d=T(d);e=T.events();var f;var n=0;for(f=e.length;n<f;n++)c[a](b+e[n],d,!1)}else c[a](b+e,d,!1);return d}}();E({$class:"ajax.transport.Script",
type:"script",_opt:null,_deferred:null,_ajax:null,_el:null,$init:function(a,b,c){this._opt=a;this._ajax=c;this._deferred=b},send:function(){var a=document.createElement("script");a.setAttribute("async","async");a.setAttribute("charset","utf-8");a.setAttribute("src",this._opt.url);F(a,"load",u(this.onLoad,this));F(a,"error",u(this.onError,this));document.head.appendChild(a);this._el=a},onLoad:function(a){this._deferred&&this._deferred.resolve(a)},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&
this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)}});E({$class:"ajax.transport.IFrame",type:"iframe",_opt:null,_deferred:null,_ajax:null,_el:null,_sent:!1,$init:function(a,b,c){this._opt=a;this._ajax=c;this._deferred=b},send:function(){var a=this,b=document.createElement("iframe"),c="frame-"+L(),e=a._opt.form;b.setAttribute("id",c);b.setAttribute("name",c);b.style.display="none";document.body.appendChild(b);e.setAttribute("action",
a._opt.url);e.setAttribute("target",c);F(b,"load",u(a.onLoad,a));F(b,"error",u(a.onError,a));a._el=b;var d=0,f=function(){d++;try{e.submit(),a._sent=!0}catch(n){2<d?a._deferred.reject(n):z(f,null,[],1E3)}};f()},onLoad:function(){var a=this._el;if(this._sent&&this._opt&&!this._opt.jsonp)try{var b=a.contentDocument||a.contentWindow.document;var c=b.body.innerHTML;this._ajax.processResponse(c)}catch(e){this._deferred.reject(e)}},onError:function(a){this._sent&&this._deferred.reject(a)},abort:function(){this._el.parentNode&&
this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)}});(function(){var a=/\?/,b=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,c=/#.*$/,e=/([?&])_=[^&]*/,d=new U,f=!(!window||!window.FormData),n=function(a,b,c){var h=b?b.dataType:null;b=b?b.selector:null;if(!r(a))return a;c=c||"";if("xml"===h||!h&&0<=c.indexOf("xml"))return a=P(R(a)),b?N(b,a):a;if("html"===h)return a=P(a,"text/html"),b?N(b,a):a;if("fragment"==h){c=
document.createDocumentFragment();h=document.createElement("div");for(h.innerHTML=a;h.firstChild;)c.appendChild(h.firstChild);return c}if("json"===h||!h&&0<=c.indexOf("json"))return Y(R(a));("script"===h||!h&&0<=c.indexOf("javascript"))&&p(a);return a+""},k=function(a){return"/"==a.substr(0,1)?location.protocol+"//"+location.host+a:a},g=function(b,d){b.replace(c,"");if(!d.allowCache){var h=(new Date).getTime();b=e.test(b)?b.replace(e,"$1_="+h):b+(a.test(b)?"&":"?")+"_="+h}!d.data||"POST"==d.method||
d.contentType||f&&d.data instanceof window.FormData||(d.data=r(d.data)?d.data:S(d.data),b+=(a.test(b)?"&":"?")+d.data,d.data=null);return b},l=function(a,b,c){var d;if(!I(a)&&"function"!=typeof a&&c){var h=document.createElement("input");h.setAttribute("type","hidden");h.setAttribute("name",c);h.setAttribute("value",a);b.appendChild(h)}else if(H(a)&&c)for(h=0,d=a.length;h<d;h++)l(a[h],b,c+"["+h+"]");else if(I(a))for(h in a)a.hasOwnProperty(h)&&l(a[h],b,c?c+"["+h+"]":h)},m=function(a){for(var b,c,
d={},h=0;h<a.elements.length;h++)if(b=a.elements[h],null!==B(b,"name"))if(c="INPUT"===b.nodeName.toUpperCase()?B(b,"type").toUpperCase():"TEXT","FILE"===c)for(c=0;c<b.files.length;d[b.name]=b.files[c++].name);else if("RADIO"!==c&&"CHECKBOX"!==c||b.checked)d[b.name]=b.value;return S(d)},p=function(a){var b=eval;a&&(/^[^\S]*use strict/.test(a)?(b=document.createElement("script"),b.text=a,document.head.appendChild(b).parentNode.removeChild(b)):b(a))};E({$class:"Ajax",$mixins:["mixin.Promise"],_jsonpName:null,
_transport:null,_opt:null,_deferred:null,_promise:null,_timeout:null,_form:null,_removeForm:!1,$init:function(a){a.url&&(a.url=k(a.url));var c=b.exec((window?window.location.href:"").toLowerCase())||[],e=b.exec(a.url.toLowerCase());this._opt=a;!0!==a.crossDomain&&!0!==a.ignoreCrossDomain&&(a.crossDomain=!(!e||e[1]===c[1]&&e[2]===c[2]&&(e[3]||("http:"===e[1]?"80":"443"))===(c[3]||("http:"===c[1]?"80":"443"))));var h;a.files&&!f&&(a.transport="iframe");"iframe"!=a.transport||a.form?a.form&&(this._form=
a.form,"POST"!=a.method||f||(a.transport="iframe")):(this.createForm(),a.form=this._form);if(a.form&&"iframe"!=a.transport&&"POST"==a.method)f?a.data=new FormData(a.form):(a.contentType="application/x-www-form-urlencoded",a.data=m(a.form));else if("json"==a.contentType)a.contentType=a.contentTypeHeader||"text/plain",a.data=r(a.data)?a.data:JSON.stringify(a.data);else if(y(a.data)&&"POST"==a.method&&f)for(h in c=a.data,a.data=new FormData,c)a.data.append(h,c[h]);a.files&&this.importFiles();a.url=g(a.url,
a);this._transport=h=!a.crossDomain&&"script"!=a.transport||a.form?"iframe"==a.transport?new t.ajax.transport.IFrame(a,this.$$promise,this):new t.ajax.transport.XHR(a,this.$$promise,this):new t.ajax.transport.Script(a,this.$$promise,this);this.$$promise.done(function(a){d.trigger("success",a)});this.$$promise.fail(function(a){d.trigger("error",a)});this.$$promise.always(function(){d.trigger("end")});d.trigger("start");a.timeout&&(this._timeout=setTimeout(u(this.onTimeout,this),a.timeout));a.jsonp&&
this.createJsonp();!1===d.trigger("before-send",a,h)&&this.$$promise.reject();a.beforeSend&&!1===a.beforeSend.call(a.context,a,h)&&this.$$promise.reject();this.$$promise.isPending()?(z(h.send,h),this.$$promise.always(this.asyncDestroy,this)):z(this.asyncDestroy,this,[],1E3)},asyncDestroy:function(){this.$isDestroyed()||(this.$$promise.hasListeners()?z(this.asyncDestroy,this,[],1E3):this.$destroy())},abort:function(a){this.$$promise.reject(a||"abort");this._transport.abort();return this},onTimeout:function(){this.abort("timeout")},
getTransport:function(){return this._transport},createForm:function(){var a=document.createElement("form");a.style.display="none";a.setAttribute("method",this._opt.method);a.setAttribute("enctype","multipart/form-data");l(this._opt.data,a,null);document.body.appendChild(a);this._form=a;this._removeForm=!0},importFiles:function(){var a=this._opt,b=a.files,c=this._form;a=a.data;var d,e;var f=0;for(d=b.length;f<d;f++){var g=b[f];if(H(g)){var l=g[0];g=g[1]}else l=window.File&&g instanceof File?g.uploadName||
"upload"+(1<d?"[]":""):g.name||"upload"+(1<d?"[]":"");if(!(window.File&&g instanceof File)){var k=g;g=null}if(c)k&&c.appendChild(k);else if(g)a.append(l,g);else if(k.files&&k.files.length)for(g=0,e=k.files.length;g<e;g++)a.append(l,k.files[g])}},createJsonp:function(){var b=this._opt,c=b.jsonpParam||"callback",d=b.jsonpCallback||"jsonp_"+L();b.url+=(a.test(b.url)?"&":"?")+c+"="+d;this._jsonpName=d;"undefined"!=typeof window&&(window[d]=u(this.jsonpCallback,this));"undefined"!=typeof global&&(global[d]=
u(this.jsonpCallback,this));return d},jsonpCallback:function(a){try{var b=this.processResponseData(a)}catch(w){this.$$promise?this.$$promise.reject(w):Z(w)}this.$$promise&&this.$$promise.resolve(b)},processResponseData:function(a,b){var c=this._opt;a=n(a,c,b);d.hasListener("process-response")&&d.trigger("process-response",a,this.$$promise);c.processResponse&&(a=c.processResponse.call(c.context,a,this.$$promise));return a},returnResponse:function(a,b){return this._opt.jsonp?null:this.processResponseData(a,
b)},processResponse:function(a,b){var c=this.$$promise;if(this._opt.jsonp)if(a){try{p(a)}catch(K){c.reject(K)}c.isPending()&&c.reject("jsonp script didn't invoke callback")}else c.reject("jsonp script is empty");else{try{var d=this.processResponseData(a,b)}catch(K){c.reject(K)}c.resolve(d)}},destroy:function(){this._timeout&&clearTimeout(this._timeout);this._form&&this._form.parentNode&&this._removeForm&&this._form.parentNode.removeChild(this._form);this._transport.$destroy();this._jsonpName&&("undefined"!=
typeof window&&delete window[this._jsonpName],"undefined"!=typeof global&&delete global[this._jsonpName])}},{prepareUrl:g,global:d})})();return function(){var a={url:null,data:null,method:"GET",headers:null,username:null,password:null,cache:null,dataType:null,timeout:0,contentType:null,xhrFields:null,jsonp:!1,jsonpParam:null,jsonpCallback:null,transport:null,replace:!1,selector:null,form:null,beforeSend:null,progress:null,uploadProgress:null,processResponse:null,context:null},b={},c=function(c,d){d=
d||{};c&&!r(c)?d=c:d.url=c;if(!d.url&&(d.form&&(d.url=B(d.form,"action")),!d.url))throw"Must provide url";v(d,b,!1,!0);v(d,a,!1,!0);d.method=d.method?d.method.toUpperCase():d.form?B(d.form,"method").toUpperCase()||"GET":"GET";return new t.Ajax(d)};c.setup=function(a){v(b,a,!0,!0)};c.on=function(){t.Ajax.global.on.apply(t.Ajax.global,arguments)};c.un=function(){t.Ajax.global.un.apply(t.Ajax.global,arguments)};c.get=function(a,b){b=b||{};b.method="GET";return c(a,b)};c.post=function(a,b){b=b||{};b.method=
"POST";return c(a,b)};c.load=function(a,b,f){f=f||{};r(b)||(f=b);f.dataType="fragment";return c(b,f).done(function(b){if(f.replace)for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(b)})};c.loadScript=function(a){return c(a,{transport:"script"})};c.submit=function(a,b){b=b||{};b.form=a;return c(null,b)};c.prepareUrl=function(a,b){return t.Ajax.prepareUrl(a,b||{})};return c}()});
